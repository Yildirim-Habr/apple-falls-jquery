/*! apple-falls, now 83% smaller! 27-July-2014 */
var BoardMaker=function(a,b){this.board=[];for(var c=0;b>c;c++)this.board.push([]);for(var d=0;d<this.board.length;d++)for(var e=0;a>e;e++)this.board[d].push("x")};BoardMaker.prototype.moveRight=function(){for(var a=0;a<this.board[0].length;a++){if("o"===this.board[0][a]&&a<this.board[0].length-1){this.board[0][a]="x",this.board[0][a+1]="o";break}if("p"===this.board[0][a]&&a<this.board[0].length-1){this.board[0][a]="x",this.board[0][a+1]="p";break}}},BoardMaker.prototype.moveLeft=function(){for(var a=0;a<this.board[0].length;a++){if("o"===this.board[0][a]&&0!==a){this.board[0][a]="x",this.board[0][a-1]="o";break}if("p"===this.board[0][a]&&0!==a){this.board[0][a]="x",this.board[0][a-1]="p";break}}},BoardMaker.prototype.deploy=function(){if(0===$parachuteCount)return!1;for(var a=0;a<this.board[0].length;a++)if("o"===this.board[0][a]){this.board[0][a]="p";var b=this;setTimeout(function(){b.undeploy()},3e3),$parachuteCount--,$timeDecreaser.current=1;break}return!1},BoardMaker.prototype.undeploy=function(){for(var a=0;a<this.board[0].length;a++)if("p"===this.board[0][a]){this.board[0][a]="o";break}return!0},$firstRun=!0,($init=function(){$gameOn=!0,$parachuteCount=3,$lifeCount=3,$scoreCount=0,$bonusChuteMultiple=5e3,$postHighScore=function(){$(".highScore").text(localStorage.highScore)},$board=new BoardMaker(5,8),$board.board[0][Math.floor($board.board[0].length/2)]="o",$(function(){$(".chuteMultiple").text($bonusChuteMultiple),localStorage.highScore?$postHighScore():$(".highScore").text("0"),($render=function(){for(var a="",b=0;b<$board.board.length;b++){a+='<span class = "boardRow">';for(var c=0;c<$board.board[b].length;c++)"o"===$board.board[b][c]&&(a+='<span class = "apple">o</span>'),"p"===$board.board[b][c]&&(a+='<span class = "parachute">p</span>'),"x"===$board.board[b][c]&&(a+='<span class = "spot">|</span>'),"b"===$board.board[b][c]&&(a+='<span class = "brick">+</span>'),"e"===$board.board[b][c]&&(a+='<span class = "bonusParachute">p</span>');a+="</span><br>"}$(".board").html(a),$(".parachutes").text($parachuteCount),$(".lives").text($lifeCount),$(".score").text($scoreCount)})()}),$deploy=function(a){a.deploy()},$bonusChuteAdder=function(){$parachuteCount++},$endOfGame=function(){clearInterval($advancer),clearInterval($generator),$gameOn=!1,localStorage.date=new Date,localStorage.lastScore=$scoreCount,localStorage.highScore=localStorage.highScore||0,localStorage.highScore<$scoreCount&&(localStorage.highScore=$scoreCount),$postHighScore(),$firstRun&&($(".instructions").prepend("GAME OVER!<br><br>"),$firstRun=!1),$(".instructions").toggle(700)},$startOfGame=function(){clearInterval($advancer),clearInterval($generator),$gameOn=!1},$timeDecreaser={cache:[750,700,680,650,600,550,500,450,400,350,300,275,250,200,200,200,150],current:-1,span:function(){return this.current<this.cache.length-1?(this.current++,this.cache[this.current]):this.cache[this.current]}},$advanceIt=function(){return $gameOn?void($advancer=setTimeout(function(){$obstacleAdvance($board.board),$obstacleGen($board.board),$advanceIt()},$timeDecreaser.span())):null},$advanceIt(),$generator=setInterval(function(){$obstacleGen($board.board),$render()},300),$(".status").text("")})();var FallingObject=function(a,b){var a=a,c=new Date;b=10*b,this.currentHeight=function(){var d=(new Date-c)/1e3,e=b*Math.pow(d,2)/2;return a-e}},keyRight=function(){$sideCollisionDetectRight($board.board),$board.moveRight(),$render()},keyLeft=function(){$sideCollisionDetectLeft($board.board),$board.moveLeft(),$render()};$(function(){$startOfGame(),$("body").on("keydown",function(a){$gameOn&&(39===a.keyCode&&keyRight(),37===a.keyCode&&keyLeft(),32===a.keyCode&&($deploy($board),$render()),81===a.keyCode&&(clearInterval($advancer),clearInterval($generator),$gameOn=!1)),$gameOn||32===a.keyCode&&($(".instructions").toggle(200),$init())})}),$obstacleGen=function(a){var b=Math.random();if(.5>b){var c=a.length,d=a[0].length,e=Math.floor(Math.random()*d);a[c-1][e]="b"}},$obstacleAdvance=function(a){$collisionDetect(a)&&$collisionHappened();for(var b=0;b<a.length-1;b++)for(var c=0;c<a[b].length;c++)"o"!==a[b][c]&&"p"!==a[b][c]&&(a[b][c]=a[b+1][c],a[b+1][c]="x");$render(),$scoreCount+=100,$scoreCount%$bonusChuteMultiple===0&&($board.board[$board.board.length-2][Math.floor(Math.random()*$board.board[0].length)]="e")},$collisionDetect=function(a){for(var b=0;b<a[0].length;b++){if(("p"===a[0][b]||"o"===a[0][b])&&"e"===a[1][b])return $bonusChuteAdder(),!1;if("o"===a[0][b]&&"p"!==a[0][b]&&"x"!==a[1][b])return!0}return!1},$sideCollisionDetectRight=function(a){for(var b=0;b<a[0].length;b++){if(("p"===a[0][b]||"o"===a[0][b])&&"e"===a[0][b+1])return $bonusChuteAdder(),!1;if("o"===a[0][b]&&"p"!==a[0][b]&&"b"===a[0][b+1])return $collisionHappened(),!0}return!1},$sideCollisionDetectLeft=function(a){for(var b=0;b<a[0].length;b++){if(("p"===a[0][b]||"o"===a[0][b])&&"e"===a[0][b-1])return $bonusChuteAdder(),!1;if("o"===a[0][b]&&"p"!==a[0][b]&&"b"===a[0][b-1])return $collisionHappened(),!0}return!1},$collisionHappened=function(){$(".container").toggleClass("crashFlash"),setTimeout(function(){$(".container").toggleClass("crashFlash")},50),0===$lifeCount?$endOfGame():$lifeCount--};