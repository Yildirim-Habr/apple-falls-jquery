/*! apple-falls 02-January-2016 */

var BoardMaker=function(a,b){this.row=a,this.col=b,this.board=[],this.primeBoard(this.board,this.row,this.col),this.gameOn=!0,this.parachuteCount=3,this.lifeCount=3,this.scoreCount=0,this.bonusChuteMultiple=1e3};BoardMaker.prototype.bonusChuteAdder=function(){this.parachuteCount++},BoardMaker.prototype.placeApple=function(){this.board[0][Math.floor(this.board[0].length/2)]="o"},BoardMaker.prototype.primeBoard=function(a,b,c){for(var d=0;c>d;d++)a.push([]);for(var e=0;e<this.board.length;e++)for(var f=0;b>f;f++)a[e].push("x")},BoardMaker.prototype.moveRight=function(a){for(var b=0;b<a[0].length;b++){if("o"===a[0][b]&&b<a[0].length-1){a[0][b]="x",a[0][b+1]="o";break}if("p"===a[0][b]&&b<a[0].length-1){a[0][b]="x",a[0][b+1]="p";break}}},BoardMaker.prototype.moveLeft=function(a){for(var b=0;b<a[0].length;b++){if("o"===a[0][b]&&0!==b){a[0][b]="x",a[0][b-1]="o";break}if("p"===a[0][b]&&0!==b){a[0][b]="x",a[0][b-1]="p";break}}},BoardMaker.prototype.deploy=function(){var a=!1;if(0===this.parachuteCount)return!1;for(var b=0;b<this.board[0].length;b++)if("o"===this.board[0][b]){this.board[0][b]="p",this.parachuteCount--,a=!0;break}if(a){var c=this;setTimeout(function(){c.undeploy()},3e3)}return!1},BoardMaker.prototype.undeploy=function(){for(var a=0;a<this.board[0].length;a++)if("p"===this.board[0][a]){this.board[0][a]="o";break}return!0},BoardMaker.prototype.render=function(a){for(var b="",c=0;c<this.board.length;c++){b+='<span class = "boardRow">';for(var d=0;d<this.board[c].length;d++)"o"===this.board[c][d]&&(b+='<span class = "apple">o</span>'),"p"===this.board[c][d]&&(b+='<span class = "parachute">p</span>'),"x"===this.board[c][d]&&(b+='<span class = "spot">|</span>'),"b"===this.board[c][d]&&(b+='<span class = "brick">+</span>'),"e"===this.board[c][d]&&(b+='<span class = "bonusParachute">p</span>');b+="</span><br>"}$(".board").html(b),this.updateCounters()},BoardMaker.prototype.updateCounters=function(){$(".parachutes").text(this.parachuteCount),$(".lives").text(this.lifeCount),$(".score").text(this.scoreCount)},BoardMaker.prototype.obstacleGen=function(a){var b=Math.random();if(.5>b){var c=a.length,d=a[0].length,e=Math.floor(Math.random()*d);a[c-1][e]="b"}},BoardMaker.prototype.obstacleAdvance=function(a){this.collisionDetect(a)&&this.collisionHappened();for(var b=0;b<a.length-1;b++)for(var c=0;c<a[b].length;c++)"o"!==a[b][c]&&"p"!==a[b][c]&&(a[b][c]=a[b+1][c],a[b+1][c]="x");this.render(),this.scoreCount+=100,this.scoreCount%this.bonusChuteMultiple===0&&(this.board[this.board.length-2][Math.floor(Math.random()*this.board[0].length)]="e")},BoardMaker.prototype.collisionDetect=function(a){for(var b=0;b<a[0].length;b++){if(("p"===a[0][b]||"o"===a[0][b])&&"e"===a[1][b])return this.bonusChuteAdder(),!1;if("o"===a[0][b]&&"p"!==a[0][b]&&"x"!==a[1][b])return!0}return!1},BoardMaker.prototype.sideCollisionDetectRight=function(a){for(var b=0;b<a[0].length;b++){if(("p"===a[0][b]||"o"===a[0][b])&&"e"===a[0][b+1])return this.bonusChuteAdder(),!1;if("o"===a[0][b]&&"p"!==a[0][b]&&"b"===a[0][b+1])return this.collisionHappened(),!0}return!1},BoardMaker.prototype.sideCollisionDetectLeft=function(a){for(var b=0;b<a[0].length;b++){if(("p"===a[0][b]||"o"===a[0][b])&&"e"===a[0][b-1])return this.bonusChuteAdder(),!1;if("o"===a[0][b]&&"p"!==a[0][b]&&"b"===a[0][b-1])return this.collisionHappened(),!0}return!1},BoardMaker.prototype.collisionHappened=function(){$(".container").addClass("crashFlash"),setTimeout(function(){$(".container").removeClass("crashFlash")},50),0===this.lifeCount?$(this).trigger("endOfGame"):this.lifeCount--};var GameLoop=function(){this.firstRun=!0,this.timeDecreaser={chuteStart:6,defaultStart:4,cache:[750,700,680,650,600,550,500,450,400,350,300,275,250,200,200,200,150],current:this.defaultStart,parachuteDeployed:function(){this.current=this.chuteStart},span:function(){return this.current<this.cache.length-1&&this.current++,this.cache[this.current]},reset:function(){this.current=this.defaultStart}}};GameLoop.prototype.postHighScore=function(){var a=localStorage.getItem("highScore");a||(a="0"),$(".highScore").text(a)},GameLoop.prototype.endOfGame=function(){clearInterval(advancer),clearInterval(generator),this.board.gameOn=!1,localStorage.setItem("date",new Date),localStorage.setItem("lastScore",this.board.$scoreCount),null===localStorage.getItem("highScore")&&localStorage.setItem("highScore",0),localStorage.getItem("highScore")<this.board.$scoreCount&&localStorage.setItem("highScore",this.board.$scoreCount),this.postHighScore(),this.firstRun&&($(".instructions").prepend("GAME OVER!<br><br>"),this.firstRun=!1),$(".instructions").toggle(400)},GameLoop.prototype.advanceIt=function(){var a=this;return this.board.gameOn?void(advancer=setTimeout(function(){a.board.obstacleAdvance(a.board.board),a.board.obstacleGen(a.board.board),a.advanceIt()},a.timeDecreaser.span())):null},GameLoop.prototype.init=function(){var a=this;this.board=new BoardMaker(5,8),$(this.board).on("endOfGame",function(){a.endOfGame()}),this.board.placeApple(),this.timeDecreaser.reset(),this.advanceIt(),generator=setInterval(function(){a.board.obstacleGen(a.board.board),a.board.render()},300),$(".status").text("")},GameLoop.prototype.clearTurnGenerators=function(){clearInterval(advancer),clearInterval(generator),this.board.gameOn=!1};var game=new GameLoop;game.init();var keyRight=function(){game.board.sideCollisionDetectRight(game.board.board),game.board.moveRight(game.board.board),game.board.render()},keyLeft=function(){game.board.sideCollisionDetectLeft(game.board.board),game.board.moveLeft(game.board.board),game.board.render()};
//# sourceMappingURL=apple-falls.min.js.map